<!DOCTYPE html>
<html lang="ka">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="მოდემის პაროლის გენერატორი MAC მისამართებისთვის">
    <title>მოდემის პაროლის გენერატორი</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100">
    <div class="p-4">
        <div class="max-w-4xl mx-auto">
            <!-- Header Section -->
            <div class="bg-white rounded-2xl shadow-xl p-6 mb-6">
                <div class="flex items-center gap-3 mb-6">
                    <svg class="w-8 h-8 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.111 16.404a5.5 5.5 0 017.778 0M12 20h.01m-7.08-7.071c3.904-3.905 10.236-3.905 14.141 0M1.394 9.393c5.857-5.857 15.355-5.857 21.213 0"></path>
                    </svg>
                    <h1 class="text-3xl font-bold text-gray-800">მოდემის პაროლის გენერატორი</h1>
                </div>

                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            MAC მისამართი
                        </label>
                        <input
                            type="text"
                            id="macInput"
                            placeholder="0C4933764EB0"
                            maxlength="17"
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none"
                        />
                        <p class="mt-1 text-sm text-gray-500">
                            ფორმატი: 12 სიმბოლო (0-9, A-F)
                        </p>
                    </div>

                    <!-- Error Message -->
                    <div id="errorMessage" class="hidden flex items-center gap-2 p-3 bg-red-50 border border-red-200 rounded-lg">
                        <svg class="w-5 h-5 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <p class="text-red-700 text-sm" id="errorText"></p>
                    </div>

                    <!-- Current Password Display -->
                    <div id="currentPassword" class="hidden bg-gradient-to-br from-indigo-50 to-blue-50 border-2 border-indigo-300 rounded-lg p-4">
                        <div class="flex items-center gap-2 mb-3">
                            <svg class="w-5 h-5 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"></path>
                            </svg>
                            <h3 class="font-semibold text-indigo-900">გენერირებული პაროლი</h3>
                        </div>
                        
                        <div class="bg-white rounded-lg p-4 mb-3">
                            <p class="text-xs text-gray-500 mb-1">MAC მისამართი:</p>
                            <p class="font-mono text-lg font-bold text-gray-800 mb-3" id="displayMac"></p>
                            
                            <p class="text-xs text-gray-500 mb-1">პაროლი:</p>
                            <p class="font-mono text-2xl font-bold text-indigo-600 break-all" id="displayPassword"></p>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-2 text-sm">
                            <div>
                                <p class="text-gray-600">შექმნილია:</p>
                                <p class="font-medium text-gray-800" id="displayCreated"></p>
                            </div>
                            <div>
                                <p class="text-gray-600">ვადა ამოიწურება:</p>
                                <p class="font-medium text-gray-800" id="displayExpiry"></p>
                            </div>
                        </div>
                        
                        <div class="mt-3 pt-3 border-t border-indigo-200">
                            <p class="text-sm text-center">
                                <span class="text-gray-600">დარჩენილი: </span>
                                <span class="font-bold text-green-600" id="displayDays"></span>
                            </p>
                        </div>
                    </div>

                    <button
                        onclick="generatePassword()"
                        class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors flex items-center justify-center gap-2"
                    >
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"></path>
                        </svg>
                        პაროლის გენერირება
                    </button>
                </div>
            </div>

            <!-- History Section -->
            <div class="bg-white rounded-2xl shadow-xl p-6">
                <div class="flex items-center gap-3 mb-6">
                    <svg class="w-6 h-6 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <h2 class="text-2xl font-bold text-gray-800">ისტორია</h2>
                </div>

                <div id="historyContainer">
                    <div class="text-center py-12 text-gray-400">
                        <svg class="w-16 h-16 mx-auto mb-4 opacity-20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.111 16.404a5.5 5.5 0 017.778 0M12 20h.01m-7.08-7.071c3.904-3.905 10.236-3.905 14.141 0M1.394 9.393c5.857-5.857 15.355-5.857 21.213 0"></path>
                        </svg>
                        <p>ჯერ არ გაქვთ გენერირებული პაროლები</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Load passwords on page load
        window.addEventListener('DOMContentLoaded', loadPasswords);

        function validateMacAddress(mac) {
            const cleanMac = mac.replace(/[:\-\s]/g, '').toUpperCase();
            return /^[0-9A-F]{12}$/.test(cleanMac);
        }

        function generatePasswordHash(mac, timestamp) {
            const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZabcdefghjkmnpqrstuvwxyz23456789!@#$%';
            let seed = 0;
            const input = mac + timestamp.toString();
            
            for (let i = 0; i < input.length; i++) {
                seed = ((seed << 5) - seed) + input.charCodeAt(i);
                seed = seed & seed;
            }
            
            let password = '';
            for (let i = 0; i < 16; i++) {
                seed = (seed * 1103515245 + 12345) & 0x7fffffff;
                password += chars[seed % chars.length];
            }
            
            return password;
        }

        function isExpired(expiryDate) {
            return Date.now() > expiryDate;
        }

        function getDaysRemaining(expiryDate) {
            const diff = expiryDate - Date.now();
            const days = Math.ceil(diff / (1000 * 60 * 60 * 24));
            return days > 0 ? days : 0;
        }

        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            const errorText = document.getElementById('errorText');
            errorText.textContent = message;
            errorDiv.classList.remove('hidden');
        }

        function hideError() {
            document.getElementById('errorMessage').classList.add('hidden');
        }

        function showCurrentPassword(passwordObj) {
            document.getElementById('displayMac').textContent = passwordObj.mac;
            document.getElementById('displayPassword').textContent = passwordObj.password;
            document.getElementById('displayCreated').textContent = passwordObj.createdAt;
            document.getElementById('displayExpiry').textContent = new Date(passwordObj.expiryDate).toLocaleString('ka-GE');
            document.getElementById('displayDays').textContent = getDaysRemaining(passwordObj.expiryDate) + ' დღე';
            document.getElementById('currentPassword').classList.remove('hidden');
        }

        function hideCurrentPassword() {
            document.getElementById('currentPassword').classList.add('hidden');
        }

        function generatePassword() {
            const macInput = document.getElementById('macInput');
            const macAddress = macInput.value.trim();
            const cleanMac = macAddress.replace(/[:\-\s]/g, '').toUpperCase();

            hideError();
            hideCurrentPassword();

            if (!validateMacAddress(macAddress)) {
                showError('არასწორი MAC მისამართი! გამოიყენეთ ფორმატი: 0C4933764EB0');
                return;
            }

            const passwords = getPasswords();
            const existingPassword = passwords.find(p => p.mac === cleanMac && !isExpired(p.expiryDate));

            if (existingPassword) {
                const daysLeft = getDaysRemaining(existingPassword.expiryDate);
                showError(`ამ MAC მისამართს უკვე აქვს აქტიური პაროლი! დარჩენილია ${daysLeft} დღე.`);
                showCurrentPassword(existingPassword);
                macInput.value = '';
                return;
            }

            const timestamp = Date.now();
            const expiryDate = new Date(timestamp + 30 * 24 * 60 * 60 * 1000);
            const password = generatePasswordHash(cleanMac, timestamp);

            const newPassword = {
                mac: cleanMac,
                password: password,
                timestamp: timestamp,
                expiryDate: expiryDate.getTime(),
                createdAt: new Date(timestamp).toLocaleString('ka-GE')
            };

            passwords.push(newPassword);
            savePasswords(passwords);
            showCurrentPassword(newPassword);
            macInput.value = '';
            loadPasswords();
        }

        function getPasswords() {
            const stored = localStorage.getItem('modemPasswords');
            return stored ? JSON.parse(stored) : [];
        }

        function savePasswords(passwords) {
            localStorage.setItem('modemPasswords', JSON.stringify(passwords));
        }

        function deletePassword(mac, timestamp) {
            const passwords = getPasswords();
            const filtered = passwords.filter(p => !(p.mac === mac && p.timestamp === timestamp));
            savePasswords(filtered);
            loadPasswords();
        }

        function loadPasswords() {
            const passwords = getPasswords().sort((a, b) => b.timestamp - a.timestamp);
            const container = document.getElementById('historyContainer');

            if (passwords.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-12 text-gray-400">
                        <svg class="w-16 h-16 mx-auto mb-4 opacity-20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.111 16.404a5.5 5.5 0 017.778 0M12 20h.01m-7.08-7.071c3.904-3.905 10.236-3.905 14.141 0M1.394 9.393c5.857-5.857 15.355-5.857 21.213 0"></path>
                        </svg>
                        <p>ჯერ არ გაქვთ გენერირებული პაროლები</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = '<div class="space-y-3">' + passwords.map(item => {
                const expired = isExpired(item.expiryDate);
                const daysLeft = getDaysRemaining(item.expiryDate);
                
                return `
                    <div class="border rounded-lg p-4 ${expired ? 'bg-red-50 border-red-200' : 'bg-gray-50 border-gray-200'}">
                        <div class="flex justify-between items-start">
                            <div class="flex-1">
                                <div class="flex items-center gap-2 mb-2">
                                    <span class="font-mono text-lg font-semibold text-gray-800">${item.mac}</span>
                                    ${expired ? '<span class="px-2 py-1 bg-red-500 text-white text-xs rounded-full">ვადაგასული</span>' : ''}
                                </div>
                                
                                <div class="bg-white border border-gray-300 rounded-lg p-3 mb-2">
                                    <p class="text-xs text-gray-500 mb-1">პაროლი:</p>
                                    <p class="font-mono text-lg font-bold text-indigo-600 break-all">${item.password}</p>
                                </div>
                                
                                <div class="grid grid-cols-2 gap-2 text-sm">
                                    <div>
                                        <p class="text-gray-500">შექმნის თარიღი:</p>
                                        <p class="font-medium text-gray-700">${item.createdAt}</p>
                                    </div>
                                    <div>
                                        <p class="text-gray-500">ვადის ამოწურვა:</p>
                                        <p class="font-medium ${expired ? 'text-red-600' : 'text-gray-700'}">
                                            ${new Date(item.expiryDate).toLocaleString('ka-GE')}
                                        </p>
                                    </div>
                                </div>
                                
                                ${!expired ? `
                                    <div class="mt-2">
                                        <p class="text-sm">
                                            <span class="text-gray-500">დარჩენილი დღეები: </span>
                                            <span class="font-semibold ${daysLeft <= 7 ? 'text-orange-600' : 'text-green-600'}">
                                                ${daysLeft} დღე
                                            </span>
                                        </p>
                                    </div>
                                ` : ''}
                            </div>
                            
                            <button
                                onclick="deletePassword('${item.mac}', ${item.timestamp})"
                                class="ml-4 p-2 text-red-500 hover:bg-red-100 rounded-lg transition-colors"
                                title="წაშლა"
                            >
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                </svg>
                            </button>
                        </div>
                    </div>
                `;
            }).join('') + '</div>';
        }

        // Allow Enter key to generate password
        document.getElementById('macInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                generatePassword();
            }
        });

        // Auto-format MAC address input
        document.getElementById('macInput').addEventListener('input', function(e) {
            e.target.value = e.target.value.toUpperCase();
        });
    </script>
</body>
</html>